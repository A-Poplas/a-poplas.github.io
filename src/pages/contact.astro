---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';

const metadata = {
  title: 'Contact',
};

// Import SendGrid package
import sgMail from '@sendgrid/mail';

// Set SendGrid API key from environment variable
sgMail.setApiKey("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");

// Define a handler function for form submission
export async function onSubmit(event) {
  // Get the form data from the event object
  const { name, email, message } = event.form;

  // Define the email message
  const msg = {
    to: 'andi.poplas@gmail.com', // Change this to your email address
    from: 'andi.poplas@gmail.com', // Change this to your sender identity
    subject: `New message from ${name}`,
    text: `Name: ${name}\nEmail: ${email}\nMessage: ${message}`,
  };

  // Send the email using SendGrid
  await sgMail.send(msg);

  // Redirect the user to a thank you page
  return {
    statusCode: 302,
    headers: {
      Location: '/thank-you',
    },
  };
}
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->

  <HeroText tagline="Contact" title="Want to get in touch?" />

  <ContactUs
    title="Feel free to message me!"
    subtitle="You can use the form below to leave a message, and you can also contact me on any social media I'm active on or contact me directly to my e-mail address."
    inputs={[
      {
        type: 'text',
        name: 'name',
        label: 'Your name',
      },
      {
        type: 'email',
        name: 'email',
        label: 'Your email',
      },
    ]}
    textarea={{
      label: 'Your message',
    }}
    disclaimer={{
      label:
        'By submitting this contact form, you acknowledge and agree to the collection of your personal information.',
    }}
    button = "Contact Me"
  />
</Layout>
